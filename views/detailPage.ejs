<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ìƒì„¸í˜ì´ì§€</title>
    <link rel="stylesheet" href="../css/detailPage.css" />
    <link rel="stylesheet" href="../css/header.css" />
    <link rel="stylesheet" href="../css/footer.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,300,0,0"
    />
  </head>

  <body>
    <%- include ('./header.ejs') %>

    <form class="detail-container">
      <input type="hidden" name="item_key" value="<%=bookInfo._id%>" />

      <div class="detail-bookcover"><img src="../imgs/noImage.png" /></div>
      <div class="detail-info">
        <div class="detail-info-box">
          <div class="detail-title-box">
            <div class="detail-info-category"><%=bookInfo.category%></div>
            <div class="detail-price-box">
              <input
                type="text"
                class="detail-info-name"
                name="itemName"
                value="<%=bookInfo.name%>"
                disabled
              />
              <input
                type="text"
                class="detail-info-price"
                name="itemPrice"
                value="<%=bookInfo.price.toLocaleString()%>"
                disabled
              />
              <span class="text-color">ì›</span>
            </div>
          </div>
          <div class="detail-explain-box">
            <div class="detail-explain-title">ìƒí’ˆì„¤ëª…</div>
          </div>

          <div class="detail-text">
            <pre>
<%=bookInfo.desc%>
                    </pre
            >
          </div>

          <div class="detail-cart-payment">
            <button
              class="detail-add-cart"
              onclick="putCart(this.form); moveCart();"
            >
              <span class="material-symbols-outlined">add_shopping_cart </span>
              <span class="add-cart-text">ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°</span>
            </button>
            <div class="add-book-count">
              <input
                type="number"
                step="1"
                min="1"
                value="1"
                id="books"
                name="itemCount"
              />&ensp;ê¶Œ
            </div>

            <button class="detail-payment-btn" onclick="booksPrice()">
              êµ¬ë§¤í•˜ê¸°
            </button>
          </div>
        </div>
      </div>
    </form>
    <%-include('footer.ejs') %>
  </body>

  <script>
    // ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸° ëˆ„ë¥´ë©´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
    function putCart(f) {
      const cartAddListArr = [
        f.itemName.value,
        Number(f.itemPrice.value),
        Number(f.itemCount.value),
        f.item_key.value,
      ];
      localStorage.setItem(f.item_key.value, JSON.stringify(cartAddListArr));
    }

    //ì½”ì¹˜ë‹˜ ì°¸ê³ ì½”ë“œ
    // localStorage.setItem('cart', JSON.stringify(cartAddListArr));
    // [{id: 'zzz', price: 3000, ìˆ˜ëŸ‰: 10}, {id: 'zzz', price: 3000, ìˆ˜ëŸ‰: 10}];

    //ë¡œê·¸ì•„ì›ƒ ìƒíƒœ ì‹œ ì˜¤ë” í˜ì´ì§€ ë§ê³  ALERT > ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    //ë¡œê·¸ì¸ ìƒíƒœ ì‹œ > êµ¬ë§¤í•˜ê¸° í´ë¦­ ì‹œ ì˜¤ë”í˜ì´ì§€ë¡œ ì´ë™
    function booksPrice() {
      if ("<%=userEmail%>" == "") {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
        window.open("/login");
      } else {
        window.open("/orders/" + "<%=bookInfo.bookNum%>");
      }
    }

    //ë¡œê·¸ì•„ì›ƒ ìƒíƒœ ì‹œ ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ ë§ê³  ALERT > ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
    //ë¡œê·¸ì¸ ìƒíƒœ ì‹œ ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ë¡œ CONFIRM >  ì´ë™
    function moveCart() {
      if ("<%=userEmail%>" == "") {
        alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
        window.open("/login");
      } else {
        let str = "ğŸ«¡ì¥ë°”êµ¬ë‹ˆì— ë‹´ê²¼ìŠµë‹ˆë‹¤! \n ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ë¡œ ì´ë™í• ê¹Œìš”?";
        let type;
        type = confirm(str);
        if (type) {
          window.location.href = "/carts";
        }
      }
    }
  </script>
</html>
